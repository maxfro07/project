Роль users
=========

Данная роль позволяет централизованно управлять пользователями на серверах, а так же их группами.


Пример добавление пользователя
-----------------

```ansible-playbook role-users.yml --extra-vars "target=web_servers" -u test --ask-become-pass```

В этой команде:

* role-users.yml - роль users которая добавляет пользователей в систему
* target=web_servers - в переменной target мы указываем в какой группе серверов добавить учётки, или на каком конкретном сервере
* -u test - имя учётки, от которой будем делать установку
* --ask-become-pass - передать системе пароль sudo

```ansible-playbook role-users.yml --extra-vars "target=web_servers" --vault-id @prompt```

Второй вариант нужен если будет шифрованный пароль написан в inventories. 


Пример удаление пользователя
-----------------
```ansible-playbook role-users.yml --extra-vars "target=web_servers" -u test --ask-become-pass -t users_deny```

Здесь мы запускаем туже роль role-users.yml, только запускаем не всю эту роль, а конкретную её часть users_deny.




Переменные
--------------

Для работы роли users нам понадобятся две структуры:

Список пользователей, которые будут добавлены на серверах

```
users:
```

список словарей, каждый элемент которого задает реквизиты пользователя, следующей структуры:

* name (строка) - имя пользователя
* shell (строка) - оболочка пользователя
* password (строка, может быть пустым) - пароль пользователя
* key_file (строка) - путь к публичному ключу пользователя для копирования на сервер


```
access_map:
``` 

Список групп в которые будут добавлены учётки на заданных серверах

* groups (строка) - группы, в которых должен состоять пользователь на заданном сервере, или группе серверов



```
deny_map:
``` 

Список пользователей, которые будут удаленны из заданных групп серверов

*  name (строка) - имя пользователя

для лучшей визуализации нужно перемещать пользователей из access_map в deny_map



Теги
----------------

* users - тег, объединяющий все действия роли (добавление пользователей, добавление пользователей в группы)
* users_deny - тег, отвечающий за удаление пользователей согласно deny_map



